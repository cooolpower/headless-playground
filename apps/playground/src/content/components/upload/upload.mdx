import { Playground } from '@/components/playground/playground';
import {
  DemoUploadBasic,
  DemoUploadBasicWithControls,
  DemoUploadBasicControls,
  DemoUploadBasicProvider,
  DemoUploadDragDrop,
  DemoUploadImage,
  DemoUploadMultiple,
  DemoUploadMaxSize,
  DemoUploadCustomTrigger,
  DemoUploadAutogeneratedFileList,
  DemoUploadBeforeUpload,
  DemoUploadChangeOnFinish,
  DemoUploadThumbnail,
  DemoUploadPicturesWall,
  DemoUploadCustomDownload,
  DemoUploadDownloadWhenFinished,
} from './upload.demo';
import { CssSnippet } from '@/components/playground/css-snippet';
import { UploadCss } from '@repo/ui';

# Upload

Upload 컴포넌트는 파일 업로드를 처리하는 Headless 컴포넌트입니다. 드래그 앤 드롭, 파일 선택, 업로드 진행 상태 등을 지원합니다.

## 기본 사용법

Upload 컴포넌트를 사용하여 파일 업로드 기능을 구현할 수 있습니다.

### 기본 Upload (인터랙티브)

<DemoUploadBasicProvider>
  <Playground
    preview={<DemoUploadBasicWithControls />}
    controls={<DemoUploadBasicControls />}
  />
</DemoUploadBasicProvider>

## 기본 업로드

<Playground preview={<DemoUploadBasic />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <Upload onChange={handleChange}>
      <Button>Click to Upload</Button>
    </Upload>
  );
}
```

## 드래그 앤 드롭

드래그 앤 드롭으로 파일을 업로드할 수 있습니다.

<Playground preview={<DemoUploadDragDrop />} />

```tsx
import { Upload } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <Upload onChange={handleChange} multiple>
      <div
        style={{
          padding: '2rem',
          border: '2px dashed var(--color-border)',
          borderRadius: '8px',
          textAlign: 'center',
        }}
      >
        <p>Click or drag file to this area to upload</p>
      </div>
    </Upload>
  );
}
```

## 이미지 업로드

이미지 파일만 허용하고 미리보기를 제공합니다. `listType="picture"`를 사용하면 썸네일과 함께 파일 리스트가 표시됩니다.

<Playground preview={<DemoUploadImage />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';

export function MyComponent() {
  return (
    <Upload accept="image/*" multiple listType="picture">
      <Button>Click to Upload Image</Button>
    </Upload>
  );
}
```

### 썸네일 리스트

`listType="picture"`를 사용하면 이미지 썸네일과 함께 파일 정보가 표시됩니다.

<Playground preview={<DemoUploadThumbnail />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';

export function MyComponent() {
  return (
    <Upload accept="image/*" multiple listType="picture">
      <Button>Click to Upload</Button>
    </Upload>
  );
}
```

### 사진 벽 (Picture Card)

`listType="picture-card"`를 사용하면 카드 형태로 이미지 썸네일이 표시됩니다.

<Playground preview={<DemoUploadPicturesWall />} />

```tsx
import { Upload } from '@repo/ui';

export function MyComponent() {
  return (
    <Upload accept="image/*" multiple listType="picture-card">
      <div
        style={{
          width: '104px',
          height: '104px',
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          border: '1px dashed var(--color-border)',
          borderRadius: 'var(--radius-sm)',
          cursor: 'pointer',
        }}
      >
        <span>Upload</span>
      </div>
    </Upload>
  );
}
```

## 다중 파일 업로드

여러 파일을 동시에 업로드할 수 있습니다.

<Playground preview={<DemoUploadMultiple />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <Upload onChange={handleChange} multiple maxCount={5}>
      <Button>Upload Multiple Files (Max 5)</Button>
    </Upload>
  );
}
```

## 파일 크기 제한

파일 크기를 제한할 수 있습니다.

<Playground preview={<DemoUploadMaxSize />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [fileList, setFileList] = useState([]);
  const [error, setError] = useState('');

  const handleChange = (files) => {
    setError('');
    const maxSize = 2 * 1024 * 1024; // 2MB
    const invalidFiles = files.filter((file) => file.size > maxSize);

    if (invalidFiles.length > 0) {
      setError(`File size exceeds 2MB limit`);
      const validFiles = files.filter((file) => file.size <= maxSize);
      setFileList(validFiles);
    } else {
      setFileList(files);
    }
  };

  return (
    <Upload onChange={handleChange}>
      <Button>Upload File (Max 2MB)</Button>
    </Upload>
  );
}
```

## 커스텀 업로드 트리거

커스텀 요소를 업로드 트리거로 사용할 수 있습니다.

<Playground preview={<DemoUploadCustomTrigger />} />

```tsx
import { Upload } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [fileList, setFileList] = useState([]);

  const handleChange = (files) => {
    setFileList(files);
  };

  return (
    <Upload onChange={handleChange}>
      <div
        style={{ padding: '8px 16px', border: '1px solid var(--color-border)' }}
      >
        Custom Upload Trigger
      </div>
    </Upload>
  );
}
```

## 기본 스타일(CSS) (Inject Styles)

<CssSnippet css={UploadCss} title="UploadCss" />

## Before Upload Hook

업로드 전에 파일을 검증하거나 변환할 수 있습니다.

<Playground preview={<DemoUploadBeforeUpload />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [message, setMessage] = useState('');

  const handleBeforeUpload = (file: File): boolean => {
    const isJPG = file.type === 'image/jpeg';
    if (!isJPG) {
      setMessage('You can only upload JPG file!');
      return false;
    }
    const isLt2M = file.size / 1024 / 1024 < 2;
    if (!isLt2M) {
      setMessage('Image must smaller than 2MB!');
      return false;
    }
    setMessage('');
    return true;
  };

  return (
    <Upload accept="image/*" beforeUpload={handleBeforeUpload}>
      <Button>Click to Upload (JPG only, max 2MB)</Button>
    </Upload>
  );
}
```

## Change File on Finish

업로드가 완료되면 콜백을 호출합니다.

<Playground preview={<DemoUploadChangeOnFinish />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';
import { useState } from 'react';

export function MyComponent() {
  const [finishedFiles, setFinishedFiles] = useState<string[]>([]);

  const handleFinish = (file: any) => {
    setFinishedFiles((prev) => [...prev, file.name]);
  };

  return (
    <Upload onFinish={handleFinish}>
      <Button>Click to Upload</Button>
    </Upload>
  );
}
```

## Custom Download

다운로드 동작을 커스터마이징할 수 있습니다.

<Playground preview={<DemoUploadCustomDownload />} />

```tsx
import { Upload } from '@repo/ui';
import { Button } from '@repo/ui';

export function MyComponent() {
  const handleDownload = (file: any) => {
    console.log('Downloading:', file.name);
    if (file.originFileObj) {
      const url = URL.createObjectURL(file.originFileObj);
      const a = document.createElement('a');
      a.href = url;
      a.download = file.name;
      a.click();
      URL.revokeObjectURL(url);
    }
  };

  return (
    <Upload
      accept="image/*"
      multiple
      listType="picture"
      onDownload={handleDownload}
    >
      <Button>Click to Upload</Button>
    </Upload>
  );
}
```

## API

### Upload Props

| Property        | Description                                          | Type                                                                                                                                          | Default  |
| --------------- | ---------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| accept          | 허용할 파일 타입 (예: "image/\*", ".pdf")            | `string`                                                                                                                                      | -        |
| multiple        | 다중 파일 업로드 허용                                | `boolean`                                                                                                                                     | `false`  |
| disabled        | 비활성화 여부                                        | `boolean`                                                                                                                                     | `false`  |
| maxCount        | 최대 업로드 파일 개수                                | `number`                                                                                                                                      | -        |
| defaultFileList | 기본 파일 리스트 (비제어 모드)                       | `UploadFile[]`                                                                                                                                | `[]`     |
| fileList        | 파일 리스트 (제어 모드)                              | `UploadFile[]`                                                                                                                                | -        |
| onChange        | 파일 리스트 변경 핸들러                              | `(fileList: UploadFile[]) => void`                                                                                                            | -        |
| onFinish        | 파일 업로드 완료 핸들러                              | `(file: UploadFile) => void`                                                                                                                  | -        |
| onError         | 파일 업로드 실패 핸들러                              | `(file: UploadFile, error: Error) => void`                                                                                                    | -        |
| beforeUpload    | 업로드 전 파일 검증/변환 (false 반환 시 업로드 취소) | `(file: File) => boolean \| Promise<boolean>`                                                                                                 | -        |
| customRequest   | 커스텀 업로드 요청 핸들러                            | `(options: { file: File; onProgress: (percent: number) => void; onSuccess: (url: string) => void; onError: (error: Error) => void }) => void` | -        |
| onDownload      | 파일 다운로드 핸들러                                 | `(file: UploadFile) => void`                                                                                                                  | -        |
| showFileList    | 파일 리스트 표시 여부                                | `boolean`                                                                                                                                     | `true`   |
| listType        | 파일 리스트 표시 타입                                | `'text' \| 'picture' \| 'picture-card'`                                                                                                       | `'text'` |
| className       | 추가 CSS 클래스                                      | `string`                                                                                                                                      | -        |
| classNames      | 스타일 클래스 객체                                   | `object`                                                                                                                                      | -        |
| children        | 업로드 트리거 요소                                   | `React.ReactNode`                                                                                                                             | -        |

### UploadFile

| Property      | Description         | Type                                            |
| ------------- | ------------------- | ----------------------------------------------- |
| uid           | 고유 식별자         | `string`                                        |
| name          | 파일명              | `string`                                        |
| status        | 업로드 상태         | `'pending' \| 'uploading' \| 'done' \| 'error'` |
| size          | 파일 크기 (bytes)   | `number`                                        |
| type          | 파일 MIME 타입      | `string`                                        |
| url           | 파일 URL            | `string`                                        |
| thumbUrl      | 썸네일 URL (이미지) | `string`                                        |
| originFileObj | 원본 File 객체      | `File`                                          |
| error         | 에러 객체           | `Error`                                         |

### classNames

| Property      | Description          |
| ------------- | -------------------- |
| upload        | Upload 컨테이너      |
| uploadTrigger | 업로드 트리거 영역   |
| uploadArea    | 드래그 앤 드롭 영역  |
| fileList      | 파일 리스트 컨테이너 |
| fileItem      | 파일 아이템          |
| fileName      | 파일명               |
| fileSize      | 파일 크기            |
| removeButton  | 제거 버튼            |
| thumbnail     | 썸네일 이미지        |
| pictureCard   | Picture card 아이템  |

## 특징

- **드래그 앤 드롭**: 파일을 드래그하여 업로드 가능
- **파일 타입 제한**: accept prop을 통해 특정 파일 타입만 허용
- **다중 파일**: multiple prop을 통해 여러 파일 동시 업로드
- **파일 개수 제한**: maxCount prop을 통해 최대 업로드 개수 제한
- **파일 리스트 관리**: 업로드된 파일 목록 표시 및 제거 기능
- **이미지 미리보기**: 이미지 파일 업로드 시 자동으로 썸네일 생성 및 표시
- **리스트 타입**: `listType` prop을 통해 텍스트, 썸네일, 카드 형태로 표시 가능
- **업로드 전 검증**: `beforeUpload` hook을 통해 업로드 전 파일 검증 및 변환 가능
- **커스텀 업로드**: `customRequest` prop을 통해 서버 업로드 로직 커스터마이징 가능
